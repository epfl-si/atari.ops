- include_tasks:
    file: setup.yml
    apply:
      tags:
        - atari.setup
  tags: always

- name: Log in to Quay
  tags:
    - atari.build
    - atari.run
  community.docker.docker_login:
    registry_url: "https://{{ quay_credentials.hostname }}"
    username: "{{ quay_credentials.username }}"
    password: "{{ quay_credentials.password }}"

- when: >-
    inventory_deployment_stage == "test"
  include_tasks:
    file: build.yml
    apply:
      tags:
        - atari.build
  tags: always

- include_tasks:
    file: run.yml
    apply:
      tags:
        - atari.run
  tags: always

# Always included but never executed without the specific tags (-t chore)
- include_tasks:
    file: chore.yml
    apply:
      tags:
        - never
  tags: always
